openapi: 3.0.3
info:
  title: BuildCheck API
  version: 0.2.0
  description: Locked request/response contract for BuildCheck MVP.
servers:
  - url: http://127.0.0.1:8080
paths:
  /health:
    get:
      summary: API health endpoint
      responses:
        "200":
          description: Health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string
                required: [status, service]
  /api/property/analyze:
    post:
      summary: Analyze one or more property images
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: ./schemas/analyze_request.schema.json
      responses:
        "200":
          description: Analysis result
          content:
            application/json:
              schema:
                $ref: ./schemas/analyze_response.schema.json
              examples:
                success:
                  value:
                    ok: true
                    request_id: req_123
                    results:
                      - filename: wall.jpg
                        ok: true
                        damage_types: [crack]
                        cost_min: 500
                        cost_max: 1500
                        inference_mode: model
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "415":
          description: Unsupported media type
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "422":
          description: Valid request but no image could be successfully analyzed
          content:
            application/json:
              schema:
                $ref: ./schemas/analyze_response.schema.json
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        ok:
          type: boolean
          enum: [false]
        request_id:
          type: string
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
          required: [code, message]
      required: [ok, request_id, error]
